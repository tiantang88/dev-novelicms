/**
 ** @author icmsdev <master@icmsdev.com>
 ** @url https://github.com/idreamsoft
 ** @version v7.0.0
 **/
(function($){

window.iCMS={version:"7.0.0",plugins:{},modules:{},data:{},UI:{},API:{},$:function(r,e){var e=e||document;if(r instanceof jQuery)return r;if("string"==typeof r){var n=r.substr(0,1);if("."==n||"#"==n)return $(r,e)}return $('[i="'+r+'"]',e)},$v:function(r,e){var n=$(r).attr("i").replace(e+":","");return n.split(":")},require:function(r){var e=iCMS.modules[r],n="exports";return"object"==typeof e?e:(e[n]||(e[n]={},e[n]=e.call(e[n],iCMS.require,e[n],e)||e[n]),e[n])},define:function(r,e){iCMS.modules[r]=e},run:function(r,e){var n=iCMS.require(r);return"function"==typeof e?e(n):n}};
!function(e){e.parseTmpl=function(e,r){var p="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(e,r){return"',"+r.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(e,r){return"');"+r.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",n=new Function("obj",p);return r?n(r):n}}(jQuery);
!function($){$.timer=function(func,time,autostart){return this.set=function(func,time,autostart){if(this.init=!0,"object"==typeof func){var paramList=["autostart","time"];for(var arg in paramList)void 0!=func[paramList[arg]]&&eval(paramList[arg]+" = func[paramList[arg]]");func=func.action}return"function"==typeof func&&(this.action=func),isNaN(time)||(this.intervalTime=time),autostart&&!this.isActive&&(this.isActive=!0,this.setTimer()),this},this.once=function(t){var i=this;return isNaN(t)&&(t=0),window.setTimeout(function(){i.action()},t),this},this.play=function(t){return this.isActive||(t?this.setTimer():this.setTimer(this.remaining),this.isActive=!0),this},this.pause=function(){return this.isActive&&(this.isActive=!1,this.remaining-=new Date-this.last,this.clearTimer()),this},this.stop=function(){return this.isActive=!1,this.remaining=this.intervalTime,this.clearTimer(),this},this.toggle=function(t){return this.isActive?this.pause():t?this.play(!0):this.play(),this},this.reset=function(){return this.isActive=!1,this.play(!0),this},this.clearTimer=function(){window.clearTimeout(this.timeoutObject)},this.setTimer=function(t){var i=this;"function"==typeof this.action&&(isNaN(t)&&(t=this.intervalTime),this.remaining=t,this.last=new Date,this.clearTimer(),this.timeoutObject=window.setTimeout(function(){i.go()},t))},this.go=function(){if(this.isActive)try{this.action()}finally{this.setTimer()}},this.init?new $.timer(func,time,autostart):(this.set(func,time,autostart),this)}}(jQuery);
!function(t){function i(){t.each(s,function(){this.refresh(!0)})}var s=[];!!window.createPopup&&"undefined"==document.documentElement.currentStyle.minWidth;t(window).resize(i),t.Poshytip=function(i,s){this.$elm=t(i),this.opts=t.extend({},t.fn.poshytip.defaults,s);var e=""!=this.opts.idName?"id="+this.opts.idName:"";this.$tip=t(["<div ",e,' class="',this.opts.className,' popover">','<div class="arrow"></div>','<div class="popover-content"></div>',"</div>"].join("")),this.$inner=this.$tip.find("div.popover-content"),this.disabled=!1,this.content=null,this.init()},t.Poshytip.hideAll=function(){t.each(s,function(){this.hide()})},t.Poshytip.prototype={init:function(){s.push(this);var i=this.$elm.attr("title");if(this.$elm.data("title.poshytip",void 0!==i?i:null).data("poshytip",this),"none"!=this.opts.showOn)switch(this.$elm.on({"mouseenter.poshytip":t.proxy(this.mouseenter,this),"mouseleave.poshytip":t.proxy(this.mouseleave,this),"touchstart.poshytip":t.proxy(this.mouseenter,this),"touchend.poshytip":t.proxy(this.mouseleave,this)}),this.opts.showOn){case"hover":"cursor"==this.opts.alignTo&&this.$elm.on("mousemove.poshytip",t.proxy(this.mousemove,this)),this.opts.allowTipHover&&this.$tip.hover(t.proxy(this.clearTimeouts,this),t.proxy(this.mouseleave,this));break;case"focus":this.$elm.on({"focus.poshytip":t.proxy(this.showDelayed,this),"blur.poshytip":t.proxy(this.hideDelayed,this)})}},mouseenter:function(t){return t.preventDefault(),!!this.disabled||(this.$elm.attr("title",""),"focus"==this.opts.showOn||void this.showDelayed())},mouseleave:function(t){if(this.disabled||this.asyncAnimating&&(this.$tip[0]===t.relatedTarget||jQuery.contains(this.$tip[0],t.relatedTarget)))return!0;if(!this.$tip.data("active")){var i=this.$elm.data("title.poshytip");null!==i&&this.$elm.attr("title",i)}return"focus"==this.opts.showOn||void this.hideDelayed()},mousemove:function(t){return!!this.disabled||(this.eventX=t.pageX,this.eventY=t.pageY,void(this.opts.followCursor&&this.$tip.data("active")&&(this.calcPos(),this.$tip.css({left:this.pos.l,top:this.pos.t}))))},show:function(){this.disabled||this.$tip.data("active")||(this.reset(),this.update(),this.content&&(this.display(),this.opts.timeOnScreen&&this.hideDelayed(this.opts.timeOnScreen)))},showDelayed:function(i){this.clearTimeouts(),this.showTimeout=setTimeout(t.proxy(this.show,this),"number"==typeof i?i:this.opts.showTimeout)},hide:function(){!this.disabled&&this.$tip.data("active")&&this.display(!0)},hideDelayed:function(i){this.clearTimeouts(),this.hideTimeout=setTimeout(t.proxy(this.hide,this),"number"==typeof i?i:this.opts.hideTimeout)},reset:function(){this.$tip.queue([]).detach().css("visibility","hidden").data("active",!1),this.$inner.find("*").poshytip("hide"),this.opts.fade&&this.$tip.css("opacity",this.opacity),this.asyncAnimating=!1},update:function(t,i){if(!this.disabled){var s=void 0!==t;if(s){if(i||(this.opts.content=t),!this.$tip.data("active"))return}else t=this.opts.content;var e=this,o="function"==typeof t?t.call(this.$elm[0],function(t){e.update(t)}):"[title]"==t?this.$elm.data("title.poshytip"):t;this.content!==o&&(this.$inner.empty().append(o),this.content=o),this.refresh(s)}},refresh:function(t){if(!this.disabled){if(t){if(!this.$tip.data("active"))return;var i={left:this.$tip.css("left"),top:this.$tip.css("top")}}if(this.$tip.css({left:0,top:0}).appendTo(document.body),void 0===this.opacity&&(this.opacity=this.$tip.css("opacity")),this.tipOuterW=this.$tip.outerWidth(),this.tipOuterH=this.$tip.outerHeight(),this.calcPos(),this.pos.arrow){this.$tip.removeClass("left right top bottom");var s={left:"right",top:"bottom",right:"left",bottom:"top"};this.$tip.addClass(s[this.pos.arrow])}if(t&&this.opts.refreshAniDuration){this.asyncAnimating=!0;this.$tip.css(i).css({left:this.pos.l,top:this.pos.t}).show()}else this.$tip.css({left:this.pos.l,top:this.pos.t})}},display:function(i){var s=this.$tip.data("active");if(!(s&&!i||!s&&i)){if(this.$tip.stop(),(this.opts.slide&&this.pos.arrow||this.opts.fade)&&(i&&this.opts.hideAniDuration||!i&&this.opts.showAniDuration)){var e={},o={};if(this.opts.slide&&this.pos.arrow){var h,p;"bottom"==this.pos.arrow||"top"==this.pos.arrow?(h="top",p="bottom"):(h="left",p="right");var r=parseInt(this.$tip.css(h));e[h]=r+(i?0:this.pos.arrow==p?-this.opts.slideOffset:this.opts.slideOffset),o[h]=r+(i?this.pos.arrow==p?this.opts.slideOffset:-this.opts.slideOffset:0)+"px"}this.opts.fade&&(e.opacity=i?this.$tip.css("opacity"):0,o.opacity=i?0:this.opacity),this.$tip.css(e).animate(o,this.opts[i?"hideAniDuration":"showAniDuration"])}if(i?this.$tip.queue(t.proxy(this.reset,this)):this.$tip.css("visibility","inherit"),s){var a=this.$elm.data("title.poshytip");null!==a&&this.$elm.attr("title",a)}this.$tip.data("active",!s)}},disable:function(){this.reset(),this.disabled=!0},enable:function(){this.disabled=!1},destroy:function(){this.reset(),this.$tip.remove(),delete this.$tip,this.content=null,this.$elm.off(".poshytip").removeData("title.poshytip").removeData("poshytip"),s.splice(t.inArray(this,s),1)},clearTimeouts:function(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=0)},updateCursorPos:function(t){this.eventX=t.pageX,this.eventY=t.pageY},calcPos:function(){var i,s,e,o,h,p,r={l:0,t:0,arrow:""},a=t(window),n={l:a.scrollLeft(),t:a.scrollTop(),w:a.width(),h:a.height()};if("cursor"==this.opts.alignTo)i=s=e=this.eventX,o=h=p=this.eventY;else{var l=this.$elm.offset(),c={l:l.left,t:l.top,w:this.$elm.outerWidth(),h:this.$elm.outerHeight()};i=c.l+("inner-right"!=this.opts.alignX?0:c.w),s=i+Math.floor(c.w/2),e=i+("inner-left"!=this.opts.alignX?c.w:0),o=c.t+("inner-bottom"!=this.opts.alignY?0:c.h),h=o+Math.floor(c.h/2),p=o+("inner-top"!=this.opts.alignY?c.h:0)}switch(this.opts.alignX){case"right":case"inner-left":r.l=e+this.opts.offsetX,this.opts.keepInViewport&&r.l+this.tipOuterW>n.l+n.w&&(r.l=n.l+n.w-this.tipOuterW),"right"!=this.opts.alignX&&"center"!=this.opts.alignY||(r.arrow="left");break;case"center":r.l=s-Math.floor(this.tipOuterW/2),this.opts.keepInViewport&&(r.l+this.tipOuterW>n.l+n.w?r.l=n.l+n.w-this.tipOuterW:r.l<n.l&&(r.l=n.l));break;default:r.l=i-this.tipOuterW-this.opts.offsetX,this.opts.keepInViewport&&r.l<n.l&&(r.l=n.l),"left"!=this.opts.alignX&&"center"!=this.opts.alignY||(r.arrow="right")}switch(this.opts.alignY){case"bottom":case"inner-top":r.t=p+this.opts.offsetY,r.arrow&&"cursor"!=this.opts.alignTo||(r.arrow="top"),this.opts.keepInViewport&&r.t+this.tipOuterH>n.t+n.h&&(r.t=o-this.tipOuterH-this.opts.offsetY,"top"==r.arrow&&(r.arrow="bottom"));break;case"center":r.t=h-Math.floor(this.tipOuterH/2),this.opts.keepInViewport&&(r.t+this.tipOuterH>n.t+n.h?r.t=n.t+n.h-this.tipOuterH:r.t<n.t&&(r.t=n.t));break;default:r.t=o-this.tipOuterH-this.opts.offsetY,r.arrow&&"cursor"!=this.opts.alignTo||(r.arrow="bottom"),this.opts.keepInViewport&&r.t<n.t&&(r.t=p+this.opts.offsetY,"bottom"==r.arrow&&(r.arrow="top"))}this.pos=r}},t.fn.poshytip=function(i){if("string"==typeof i){var s=arguments,e=i;return Array.prototype.shift.call(s),"destroy"==e&&(this.die?this.die("mouseenter.poshytip").die("touchstart.poshytip").die("focus.poshytip"):t(document).off(this.selector,"mouseenter.poshytip").off(this.selector,"touchstart.poshytip").off(this.selector,"focus.poshytip")),this.each(function(){var i=t(this).data("poshytip");i&&i[e]&&i[e].apply(i,s)})}var o=t.extend({},t.fn.poshytip.defaults,i);if(o.liveEvents&&"none"!=o.showOn){var h,p=t.extend({},o,{liveEvents:!1});switch(o.showOn){case"hover":h=function(){var i=t(this);i.data("poshytip")||i.poshytip(p).poshytip("mouseenter"),i.poshytip(p).poshytip("touchstart"),i.poshytip(p).poshytip("click")},this.live?this.live("mouseenter.poshytip,touchstart.poshytip,click.poshytip",h):t(document).on(this.selector,"mouseenter.poshytip,touchstart.poshytip,click.poshytip",h);break;case"focus":h=function(){var i=t(this);i.data("poshytip")||i.poshytip(p).poshytip("showDelayed")},this.live?this.live("focus.poshytip",h):t(document).on(this.selector,"focus.poshytip",h)}}return this.each(function(){new t.Poshytip(this,o)})},t.fn.poshytip.defaults={content:"[title]",className:"tip-yellow",idName:"",showTimeout:500,hideTimeout:100,timeOnScreen:0,showOn:"hover",liveEvents:!1,alignTo:"cursor",alignX:"right",alignY:"top",offsetX:-22,offsetY:18,keepInViewport:!0,allowTipHover:!0,followCursor:!1,fade:!0,slide:!0,slideOffset:8,showAniDuration:300,hideAniDuration:300,refreshAniDuration:200}}(jQuery);
iCMS.define("config",{API:"/public/api.php",UHOME:"/user/{uid}/",PUBLIC:"/public/",COOKIE:"iCMS_",AUTH:"USER_AUTH",DIALOG:[],APP:"iCMS"});
iCMS.define("cookie",{set:function(e,o,i,n,t,c){var u=new Date;u.setTime(u.getTime()+i),e=iCMS.CONFIG.COOKIE+"_"+e,document.cookie=escape(e)+"="+escape(o)+(u?"; expires="+u.toGMTString():"")+(n?"; path="+n:"/")+(t?"; domain="+t:"")+(c?"; secure":"")},get:function(e){e=iCMS.CONFIG.COOKIE+"_"+e;var o=document.cookie.indexOf(e),i=document.cookie.indexOf(";",o);return o==-1?"":unescape(document.cookie.substring(o+e.length+1,i>o?i:document.cookie.length))}});
iCMS.define("api",{url:function(r,t){return iCMS.CONFIG.API+"?app="+r+(t||"")},param:function(r){var t=$(r),a=t.parent(),n=this.get_param(t),e=this.get_param(a);return $.extend(e,n)},get_param:function(r,t){var a=function(r){var t=[],n=function(r){return"object"==typeof r&&null!=r?a(r):/^(string|number)$/.test(typeof r)?'"'+r+'"':r};for(var e in r)t.push('"'+e+'":'+n(r[e]));return"{"+t.join(",")+"}"};if(t)return void r.attr("data-param",a(t));var t=r.attr("data-param")||!1;return t?$.parseJSON(t):{}}});
iCMS.define("artdialog",function(){function t(t,e){t=iCMS.CONFIG.PUBLIC+"/"+t;var i=document.createElement("link"),o=document.getElementsByTagName("head")[0];i.id=e,i.href=t,i.type="text/css",i.rel="stylesheet",o.insertBefore(i,o.firstChild)}return t("js/libs/artDialog/ui-dialog.css","ui_dialog_css"),!function(){function t(e){var o=i[e],n="exports";return"object"==typeof o?o:(o[n]||(o[n]={},o[n]=o.call(o[n],t,o[n],o)||o[n]),o[n])}function e(t,e){i[t]=e}var i={};e("jquery",function(){return jQuery}),e("popup",function(t){function e(){this.destroyed=!1,this.__popup=i("<div />").css({display:"none",position:"absolute",outline:0}).attr("tabindex","-1").html(this.innerHTML).appendTo("body"),this.__backdrop=this.__mask=i("<div />").css({opacity:.7,background:"#000"}),this.node=this.__popup[0],this.backdrop=this.__backdrop[0],o++}var i=t("jquery"),o=0,n=!("minWidth"in i("html")[0].style),s=!n;return i.extend(e.prototype,{node:null,backdrop:null,fixed:!1,destroyed:!0,open:!1,returnValue:"",autofocus:!0,align:"bottom left",innerHTML:"",className:"ui-popup",show:function(t){if(this.destroyed)return this;var o=this.__popup,r=this.__backdrop;if(this.__activeElement=this.__getActive(),this.open=!0,this.follow=t||this.follow,!this.__ready){if(o.addClass(this.className).attr("role",this.modal?"alertdialog":"dialog").css("position",this.fixed?"fixed":"absolute"),n||i(window).on("resize",i.proxy(this.reset,this)),this.modal){var a={position:"fixed",left:0,top:0,width:"100%",height:"100%",overflow:"hidden",userSelect:"none",zIndex:this.zIndex||e.zIndex};o.addClass(this.className+"-modal"),s||i.extend(a,{position:"absolute",width:i(window).width()+"px",height:i(document).height()+"px"}),r.css(a).attr({tabindex:"0"}).on("focus",i.proxy(this.focus,this)),this.__mask=r.clone(!0).attr("style","").insertAfter(o),r.addClass(this.className+"-backdrop").insertBefore(o),this.__ready=!0}o.html()||o.html(this.innerHTML)}return o.addClass(this.className+"-show").show(),r.show(),this.reset().focus(),this.__dispatchEvent("show"),this},showModal:function(){return this.modal=!0,this.show.apply(this,arguments)},close:function(t){return!this.destroyed&&this.open&&(void 0!==t&&(this.returnValue=t),this.__popup.hide().removeClass(this.className+"-show"),this.__backdrop.hide(),this.open=!1,this.blur(),this.__dispatchEvent("close")),this},remove:function(){if(this.destroyed)return this;this.__dispatchEvent("beforeremove"),e.current===this&&(e.current=null),this.__popup.remove(),this.__backdrop.remove(),this.__mask.remove(),n||i(window).off("resize",this.reset),this.__dispatchEvent("remove");for(var t in this)delete this[t];return this},reset:function(){var t=this.follow;return t?this.__follow(t):this.__center(),this.__dispatchEvent("reset"),this},focus:function(){var t=this.node,o=this.__popup,n=e.current,s=this.zIndex=e.zIndex++;if(n&&n!==this&&n.blur(!1),!i.contains(t,this.__getActive())){var r=o.find("[autofocus]")[0];!this._autofocus&&r?this._autofocus=!0:r=t,this.__focus(r)}return o.css("zIndex",s),e.current=this,o.addClass(this.className+"-focus"),this.__dispatchEvent("focus"),this},blur:function(){var t=this.__activeElement,e=arguments[0];return e!==!1&&this.__focus(t),this._autofocus=!1,this.__popup.removeClass(this.className+"-focus"),this.__dispatchEvent("blur"),this},addEventListener:function(t,e){return this.__getEventListener(t).push(e),this},removeEventListener:function(t,e){for(var i=this.__getEventListener(t),o=0;o<i.length;o++)e===i[o]&&i.splice(o--,1);return this},__getEventListener:function(t){var e=this.__listener;return e||(e=this.__listener={}),e[t]||(e[t]=[]),e[t]},__dispatchEvent:function(t){var e=this.__getEventListener(t);this["on"+t]&&this["on"+t]();for(var i=0;i<e.length;i++)e[i].call(this)},__focus:function(t){try{this.autofocus&&!/^iframe$/i.test(t.nodeName)&&t.focus()}catch(e){}},__getActive:function(){try{var t=document.activeElement,e=t.contentDocument,i=e&&e.activeElement||t;return i}catch(o){}},__center:function(){var t=this.__popup,e=i(window),o=i(document),n=this.fixed,s=n?0:o.scrollLeft(),r=n?0:o.scrollTop(),a=e.width(),c=e.height(),l=t.width(),h=t.height(),d=(a-l)/2+s,u=382*(c-h)/1e3+r,f=t[0].style;f.left=Math.max(parseInt(d),s)+"px",f.top=Math.max(parseInt(u),r)+"px"},__follow:function(t){var e=t.parentNode&&i(t),o=this.__popup;if(this.__followSkin&&o.removeClass(this.__followSkin),e){var n=e.offset();if(n.left*n.top<0)return this.__center()}var s=this,r=this.fixed,a=i(window),c=i(document),l=a.width(),h=a.height(),d=c.scrollLeft(),u=c.scrollTop(),f=o.width(),p=o.height(),v=e?e.outerWidth():0,_=e?e.outerHeight():0,g=this.__offset(t),m=g.left,b=g.top,y=r?m-d:m,w=r?b-u:b,k=r?0:d,x=r?0:u,E=k+l-f,C=x+h-p,L={},N=this.align.split(" "),T=this.className+"-",$={top:"bottom",bottom:"top",left:"right",right:"left"},I={top:"top",bottom:"top",left:"left",right:"left"},M=[{top:w-p,bottom:w+_,left:y-f,right:y+v},{top:w,bottom:w-p+_,left:y,right:y-f+v}],j={left:y+v/2-f/2,top:w+_/2-p/2},z={left:[k,E],top:[x,C]};i.each(N,function(t,e){M[t][e]>z[I[e]][1]&&(e=N[t]=$[e]),M[t][e]<z[I[e]][0]&&(N[t]=$[e])}),N[1]||(I[N[1]]="left"===I[N[0]]?"top":"left",M[1][N[1]]=j[I[N[1]]]),T+=N.join("-")+" "+this.className+"-follow",s.__followSkin=T,e&&o.addClass(T),L[I[N[0]]]=parseInt(M[0][N[0]]),L[I[N[1]]]=parseInt(M[1][N[1]]),o.css(L)},__offset:function(t){var e=t.parentNode,o=e?i(t).offset():{left:t.pageX,top:t.pageY};t=e?t:t.target;var n=t.ownerDocument,s=n.defaultView||n.parentWindow;if(s==window)return o;var r=s.frameElement,a=i(n),c=a.scrollLeft(),l=a.scrollTop(),h=i(r).offset(),d=h.left,u=h.top;return{left:o.left+d-c,top:o.top+u-l}}}),e.zIndex=1024,e.current=null,e}),e("dialog-config",{backdropBackground:"#000",backdropOpacity:.7,content:'<span class="ui-dialog-loading">Loading..</span>',title:"",statusbar:"",button:null,ok:null,cancel:null,okValue:"ok",cancelValue:"cancel",cancelDisplay:!0,width:"",height:"",padding:"",skin:"",quickClose:!1,cssUri:"../css/ui-dialog.css",innerHTML:'<div i="dialog" class="ui-dialog"><div class="ui-dialog-arrow-a"></div><div class="ui-dialog-arrow-b"></div><table class="ui-dialog-grid"><tr><td i="header" class="ui-dialog-header"><button i="close" class="ui-dialog-close">&#215;</button><div i="title" class="ui-dialog-title"></div></td></tr><tr><td i="body" class="ui-dialog-body"><div i="content" class="ui-dialog-content"></div></td></tr><tr><td i="footer" class="ui-dialog-footer"><div i="statusbar" class="ui-dialog-statusbar"></div><div i="button" class="ui-dialog-button"></div></td></tr></table></div>'}),e("dialog",function(t){var e=t("jquery"),i=t("popup"),o=t("dialog-config"),n=o.cssUri;if(n){var s=t[t.toUrl?"toUrl":"resolve"];s&&(n=s(n),n='<link rel="stylesheet" href="'+n+'" />',e("base")[0]?e("base").before(n):e("head").append(n))}var r=0,a=new Date-0,c=!("minWidth"in e("html")[0].style),l="createTouch"in document&&!("onmousemove"in document)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent),h=!c&&!l,d=function(t,i,o){var n=t=t||{};("string"==typeof t||1===t.nodeType)&&(t={content:t,fixed:!l}),t=e.extend(!0,{},d.defaults,t),t.original=n;var s=t.id=t.id||a+r,c=d.get(s);return c?c.focus():(h||(t.fixed=!1),t.quickClose&&(t.modal=!0),e.isArray(t.button)||(t.button=[]),void 0!==o&&(t.cancel=o),t.cancel&&t.button.push({id:"cancel",value:t.cancelValue,callback:t.cancel,display:t.cancelDisplay}),void 0!==i&&(t.ok=i),t.ok&&t.button.push({id:"ok",value:t.okValue,callback:t.ok,autofocus:!0}),d.list[s]=new d.create(t))},u=function(){};u.prototype=i.prototype;var f=d.prototype=new u;return d.create=function(t){var o=this;e.extend(this,new i);var n=(t.original,e(this.node).html(t.innerHTML)),s=e(this.backdrop);return this.options=t,this._popup=n,e.each(t,function(t,e){"function"==typeof o[t]?o[t](e):o[t]=e}),t.zIndex&&(i.zIndex=t.zIndex),n.attr({"aria-labelledby":this._$("title").attr("id","title:"+this.id).attr("id"),"aria-describedby":this._$("content").attr("id","content-"+this.id).attr("id")}),this._$("close").css("display",this.cancel===!1?"none":"").attr("title",this.cancelValue).on("click",function(t){o._trigger("cancel"),t.preventDefault()}),this._$("dialog").addClass(this.skin),this._$("body").css("padding",this.padding),t.quickClose&&s.on("onmousedown"in document?"mousedown":"click",function(){return o._trigger("cancel"),!1}),this.addEventListener("show",function(){s.css({opacity:0,background:t.backdropBackground}).animate({opacity:t.backdropOpacity},150)}),this._esc=function(t){var e=t.target,n=e.nodeName,s=/^input|textarea$/i,r=i.current===o,a=t.keyCode;!r||s.test(n)&&"button"!==e.type||27===a&&o._trigger("cancel")},e(document).on("keydown",this._esc),this.addEventListener("remove",function(){e(document).off("keydown",this._esc),delete d.list[this.id]}),r++,d.oncreate(this),this},d.create.prototype=f,e.extend(f,{content:function(t){var i=this._$("content");return"object"==typeof t?(t=e(t),i.empty("").append(t.show()),this.addEventListener("remove",function(){e("body").append(t.hide())})):i.html(t),this.reset()},title:function(t){return this._$("title").text(t),this._$("header")[t?"show":"hide"](),this},width:function(t){return this._$("content").css("width",t),this.reset()},height:function(t){return this._$("content").css("height",t),this.reset()},button:function(t){t=t||[];var i=this,o="",n=0;return this.callbacks={},"string"==typeof t?(o=t,n++):e.each(t,function(t,s){var r=s.id=s.id||s.value,a="";i.callbacks[r]=s.callback,s.display===!1?a=' style="display:none"':n++,o+='<button type="button" i-id="'+r+'"'+a+(s.disabled?" disabled":"")+(s.autofocus?' autofocus class="ui-dialog-autofocus"':"")+">"+s.value+"</button>",i._$("button").on("click","[i-id="+r+"]",function(t){var o=e(this);o.attr("disabled")||i._trigger(r),t.preventDefault()})}),this._$("button").html(o),this._$("footer")[n?"show":"hide"](),this},statusbar:function(t){return this._$("statusbar").html(t)[t?"show":"hide"](),this},_$:function(t){return this._popup.find("[i="+t+"]")},_trigger:function(t){var e=this.callbacks[t];return"function"!=typeof e||e.call(this)!==!1?this.close().remove():this}}),d.oncreate=e.noop,d.getCurrent=function(){return i.current},d.get=function(t){return void 0===t?d.list:d.list[t]},d.list={},d.defaults=o,d}),e("drag",function(t){var e=t("jquery"),i=e(window),o=e(document),n="createTouch"in document,s=document.documentElement,r=!("minWidth"in s.style),a=!r&&"onlosecapture"in s,c="setCapture"in s,l={start:n?"touchstart":"mousedown",over:n?"touchmove":"mousemove",end:n?"touchend":"mouseup"},h=n?function(t){return t.touches||(t=t.originalEvent.touches.item(0)),t}:function(t){return t},d=function(){this.start=e.proxy(this.start,this),this.over=e.proxy(this.over,this),this.end=e.proxy(this.end,this),this.onstart=this.onover=this.onend=e.noop};return d.types=l,d.prototype={start:function(t){return t=this.startFix(t),o.on(l.over,this.over).on(l.end,this.end),this.onstart(t),!1},over:function(t){return t=this.overFix(t),this.onover(t),!1},end:function(t){return t=this.endFix(t),o.off(l.over,this.over).off(l.end,this.end),this.onend(t),!1},startFix:function(t){return t=h(t),this.target=e(t.target),this.selectstart=function(){return!1},o.on("selectstart",this.selectstart).on("dblclick",this.end),a?this.target.on("losecapture",this.end):i.on("blur",this.end),c&&this.target[0].setCapture(),t},overFix:function(t){return t=h(t)},endFix:function(t){return t=h(t),o.off("selectstart",this.selectstart).off("dblclick",this.end),a?this.target.off("losecapture",this.end):i.off("blur",this.end),c&&this.target[0].releaseCapture(),t}},d.create=function(t,n){var s,r,a,c,l=e(t),h=new d,u=d.types.start,f=function(){},p=t.className.replace(/^\s|\s.*/g,"")+"-drag-start",v={onstart:f,onover:f,onend:f,off:function(){l.off(u,h.start)}};return h.onstart=function(e){var n="fixed"===l.css("position"),h=o.scrollLeft(),d=o.scrollTop(),u=l.width(),f=l.height();s=0,r=0,a=n?i.width()-u+s:o.width()-u,c=n?i.height()-f+r:o.height()-f;var _=l.offset(),g=this.startLeft=n?_.left-h:_.left,m=this.startTop=n?_.top-d:_.top;this.clientX=e.clientX,this.clientY=e.clientY,l.addClass(p),v.onstart.call(t,e,g,m)},h.onover=function(e){var i=e.clientX-this.clientX+this.startLeft,o=e.clientY-this.clientY+this.startTop,n=l[0].style;i=Math.max(s,Math.min(a,i)),o=Math.max(r,Math.min(c,o)),n.left=i+"px",n.top=o+"px",v.onover.call(t,e,i,o)},h.onend=function(e){var i=l.position(),o=i.left,n=i.top;l.removeClass(p),v.onend.call(t,e,o,n)},h.off=function(){l.off(u,h.start)},n?h.start(n):l.on(u,h.start),v},d}),e("dialog-plus",function(t){var e=t("jquery"),i=t("dialog"),o=t("drag");return i.oncreate=function(t){var i,n=t.options,s=n.original,r=n.url,a=n.oniframeload;if(r&&(this.padding=n.padding=0,i=e("<iframe />"),i.attr({src:r,name:t.id,width:"100%",height:"100%",allowtransparency:"yes",frameborder:"no",scrolling:"no"}).on("load",function(){var e;try{e=i[0].contentWindow.frameElement}catch(o){}e&&(n.width||t.width(i.contents().width()),n.height||t.height(i.contents().height())),a&&a.call(t)}),t.addEventListener("beforeremove",function(){i.attr("src","about:blank").remove()},!1),t.content(i[0]),t.iframeNode=i[0]),!(s instanceof Object))for(var c=function(){t.close().remove()},l=0;l<frames.length;l++)try{if(s instanceof frames[l].Object){e(frames[l]).one("unload",c);break}}catch(h){}e(t.node).on(o.types.start,"[i=title]",function(e){t.follow||(t.focus(),o.create(t.node,e))})},i.get=function(t){if(t&&t.frameElement){var e,o=t.frameElement,n=i.list;for(var s in n)if(e=n[s],e.node.getElementsByTagName("iframe")[0]===o)return e}else if(t)return i.list[t]},i}),window.dialog=t("dialog-plus")}(),dialog});
iCMS.define("ui.dialog",function(o){var e=iCMS.require("artdialog");return function(o,i){function n(o){window.clearTimeout(a),"function"==typeof i&&i(o)}function t(o){return'<table class="ui-dialog-table" align="center"><tr><td valign="middle"><div class="iPHP-msg"><span class="label label-'+c.label+'"><i class="fa fa-'+c.icon+'"></i> '+o+"</span></div></td></tr></table>"}var l={id:"iCMS-DIALOG",title:"iCMS - 提示信息",className:"iCMS_UI_DIALOG",backdropBackground:"#333",backdropOpacity:.5,fixed:!0,autofocus:!1,quickClose:!0,modal:!0,time:null,label:"success",icon:"check",api:!1},a=null,c=$.extend(l,iCMS.CONFIG.DIALOG,o);c.follow&&(c.fixed=!1,c.modal=!1,c.skin="iCMS_tooltip_popup",c.className="ui-popup",c.backdropOpacity=0);var r=c.content;r instanceof jQuery?c.content=r:"string"==typeof r&&(c.content=t(r)),c.onclose=function(){n("close")},c.onbeforeremove=function(){n("beforeremove")},c.onremove=function(){n("remove")};var s=e(c);return c.modal?s.showModal():(s.show(c.follow),c.follow),c.time&&(a=window.setTimeout(function(){s.destroy()},c.time)),s.destroy=function(){s.close().remove()},s}});
iCMS.define("ui",{$dialog:{},dialog:function(i,e){var a=iCMS.require("ui.dialog");return this.$dialog=a(i,e),this.$dialog},success:function(i,e){this.alert(i,!0,e)},alert:function(i,e,a){var c=iCMS.require("ui.dialog"),o=e?{label:"success",icon:"check"}:{label:"warning",icon:"warning"};o.id="iCMS-DIALOG-ALERT",o.skin="iCMS_dialog_alert",o.content=i,o.time=3e3,o.modal=!0,c(o,a)},seccode:function(i,e){var a=iCMS.require("api"),i=i||".seccode-img",e=e||"body";$(i,e).attr("src",a.url("public","&do=seccode&")+Math.random())}});
iCMS.define("utils",{addcss:function(e,r){e=iCMS.CONFIG.PUBLIC+"/"+e;var a=document.createElement("link"),l=document.getElementsByTagName("head")[0];a.id=r,a.href=e,a.type="text/css",a.rel="stylesheet",l.insertBefore(a,l.firstChild)},addjs:function(e,r){url=iCMS.CONFIG.PUBLIC+"/"+e+".js";var a=document.createElement("script"),l=document.getElementsByTagName("head")[0];a.id=r,a.src=url,l.insertBefore(a,l.firstChild)},format:function(e,r){function a(e,r){for(var a="",l=e.split("[iCMS.N]"),i=0;i<l.length;i++){for(;" "==l[i].substr(0,1)||"　"==l[i].substr(0,1);)l[i]=l[i].substr(1,l[i].length);l[i].length>0&&(a+=r?l[i]+"\n":"<p>"+l[i]+"</p>")}return a}return e=e.replace(/\/"/g,'"').replace(/\\\&quot;/g,"").replace(/\r/g,"").replace(/on(\w+)="[^"]+"/gi,"").replace(/<script[^>]*?>(.*?)<\/script>/gi,"").replace(/<style[^>]*?>(.*?)<\/style>/gi,"").replace(/style=[" ]?([^"]+)[" ]/gi,"").replace(/<a[^>]+href=[" ]?([^"]+)[" ]?[^>]*>(.*?)<\/a>/gi,"[url=$1]$2[/url]").replace(/<img[^>]+src=[" ]?([^"]+)[" ]?[^>]*>/gi,"[img]$1[/img]").replace(/<embed/g,"\n<embed").replace(/<embed[^>]+class="edui-faked-video"[^"].+src=[" ]?([^"]+)[" ]+width=[" ]?([^"]\d+)[" ]+height=[" ]?([^"]\d+)[" ]?[^>]*>/gi,"[video=$2,$3]$1[/video]").replace(/<embed[^>]+class="edui-faked-music"[^"].+src=[" ]?([^"]+)[" ]+width=[" ]?([^"]\d+)[" ]+height=[" ]?([^"]\d+)[" ]?[^>]*>/gi,"[music=$2,$3]$1[/music]").replace(/<b[^>]*>(.*?)<\/b>/gi,"[b]$1[/b]").replace(/<strong[^>]*>(.*?)<\/strong>/gi,"[b]$1[/b]").replace(/<p[^>]*?>/g,"\n\n").replace(/<br[^>]*?>/g,"\n").replace(/<li[^>]*?>/g,"\n").replace(/<[^>]*?>/g,""),r?(e=e.replace(/\n+/g,"[iCMS.N]"),e=a(e,r)):(e=e.replace(/\[url=([^\]]+)\]\n(\[img\]\1\[\/img\])\n\[\/url\]/g,"$2").replace(/\[img\](.*?)\[\/img\]/gi,'<p><img src="$1" /></p>').replace(/\[b\](.*?)\[\/b\]/gi,"<b>$1</b>").replace(/\[url=([^\]|#]+)\](.*?)\[\/url\]/g,"$2").replace(/\[url=([^\]]+)\](.*?)\[\/url\]/g,'<a target="_blank" href="$1">$2</a>').replace(/\n+/g,"[iCMS.N]"),e=a(e),e=e.replace(/#--iCMS.PageBreak--#/g,"<!---->#--iCMS.PageBreak--#").replace(/<p>\s*<p>/g,"<p>").replace(/<\/p>\s*<\/p>/g,"</p>").replace(/<p>\s*<\/p>/g,"").replace(/\[video=(\d+),(\d+)\](.*?)\[\/video\]/gi,'<embed type="application/x-shockwave-flash" class="edui-faked-video" pluginspage="http://www.macromedia.com/go/getflashplayer" src="$3" width="$1" height="$2" wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true"/>').replace(/\[music=(\d+),(\d+)\](.*?)\[\/music\]/gi,'<embed type="application/x-shockwave-flash" class="edui-faked-music" pluginspage="http://www.macromedia.com/go/getflashplayer" src="$3" width="$1" height="$2" wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" align="none"/>').replace(/<p><br\/><\/p>/g,""))},random:function(e){e=e||16;var r="abcdefhjmnpqrstuvwxyz23456789ABCDEFGHJKLMNPQRSTUVWYXZ",a="";for(i=0;i<e;i++)a+=r.charAt(Math.floor(Math.random()*r.length));return a},callback:function(e,r,a,l,i){var c=r||l.SUCCESS,t=a||l.FAIL;e.code?this.__callback(c,e,i):this.__callback(t,e,i)},__callback:function(e,r,a){if("function"==typeof e)e(r,a);else{var l=r;"object"==typeof r&&(l=r.msg||"error");var i=iCMS.require("ui");i.alert(l)}}});
iCMS.define("user",function(e){var t=iCMS.require("utils"),n=iCMS.require("api"),i=iCMS.require("ui");return $User={INBOX_URL:iCMS.CONFIG.API+"?app=user&do=manage&pg=inbox",widget:{loading:'<div class="tip_info"><img src="'+iCMS.CONFIG.PUBLIC+'/ui/loading.gif"><span> 用户信息加载中……</span></div>'}},$.extend($User,{NOAVATAR:function(e){e.src=iCMS.CONFIG.PUBLIC+"/ui/avatar.gif"},NOCOVER:function(e,t){var n="coverpic";"m"==t&&(n="coverpic"),e.src=iCMS.CONFIG.PUBLIC+"/ui/"+n+".jpg"},STATUS:function(e,i,a){var o=this;$.get(n.url("user","&do=data"),e,function(e){e.code&&($User.data=e),t.callback(e,i,a,o)},"json")},AUTH:function(){var e=iCMS.require("cookie");return!!e.get(iCMS.CONFIG.AUTH)},CHECK:{LOGIN:function(){var e=$User.AUTH();return!!e||$User.LOGIN()}},UHOME:function(e){return iCMS.CONFIG.UHOME.replace("{uid}",e)},LOGIN:function(){window.location.href=n.url("user","&do=login")},LOGOUT:function(e,i,a){var o=this;$.get(n.url("user","&do=logout"),e,function(e){t.callback(e,i,a,o)},"json")},FOLLOW:function(e,i,a){var o=this;if(this.CHECK.LOGIN()){var r=$(e).attr("i").replace("follow:","").split(":"),c={uid:r[0],follow:r[1],action:"follow"};$.post(n.url("user"),c,function(e){t.callback(e,i,a,o,c)},"json")}},UCARD:function(e){$("[i^='ucard']",e||document).poshytip({idName:"iCMS-UCARD",className:"iCMS_UI_TOOLTIP",alignTo:"target",alignX:"center",liveEvents:!0,offsetX:0,offsetY:5,fade:!1,slide:!1,content:function(e){var t=$(this).attr("i").replace("ucard:","");return t&&$.get(n.url("user","&do=ucard"),{uid:t},e),$User.widget.loading}})},PM:function(e){if(this.CHECK.LOGIN()){var t=($(e),document.getElementById("iCMS-PM-DIALOG")),a=i.dialog({title:"发送私信",quickClose:!1,width:"auto",height:"auto",content:t}),o=iCMS.$v(e,"pm");param={uid:o[0],name:o[1]},content=$("[name='content']",t).val(""),o[2]&&(param.mid=o[2]),$(".pm_warnmsg",t).hide(),$(".pm_uname",t).text(param.name),$User.INBOX_URL?$(".pm_inbox",t).attr("href",$User.INBOX_URL):$(".pm_inbox",t).hide(),$(".cancel",t).click(function(e){e.preventDefault(),a.remove()}),$('[name="send"]',t).click(function(e){return e.preventDefault(),param.content=content.val(),param.content?(param.action="pm",void $.post(n.url("message"),param,function(e){a.remove(),i.alert(e.msg,e.code)},"json")):(content.focus(),$(".pm_warnmsg",t).show(),!1)})}},REPORT:function(e){if(this.CHECK.LOGIN()){var t=$(e),a=t.attr("title")||"为什么举报这个评论?",o=document.getElementById("iCMS-REPORT-DIALOG"),r=i.dialog({title:a,content:o,quickClose:!1,width:"auto",height:"auto"});$("li",o).click(function(e){e.preventDefault(),$("li",o).removeClass("checked"),$(this).addClass("checked"),$("[name='reason']",this).prop("checked",!0)}),$(".cancel",o).click(function(e){e.preventDefault(),r.remove()}),$('[name="ok"]',o).click(function(e){e.preventDefault();var a=n.param(t),c=$("[name='content']",o);return a.reason=$("[name='reason']:checked",o).val(),a.reason?"0"!=a.reason||(a.content=c.val(),a.content)?(a.action="report",void $.post(n.url("user"),a,function(e){c.val(""),$("li",o).removeClass("checked"),$("[name='reason']",o).removeAttr("checked"),i.alert(e.msg,e.code),e.code&&r.remove()},"json")):(i.alert("请填写举报的原因"),!1):(i.alert("请选择举报的原因"),!1)})}}})});
iCMS.define("passport",function(t){var n=iCMS.require("api");return{SUCCESS:{},FAIL:{},__post:function(t){var i=this;$.post(n.url("user"),t,function(t){i.__callback(t)},"json")},__callback:function(t,n,i){var c=iCMS.require("utils");c.callback(t,n,i,this)},LOGIN:function(t){t=$.extend(t,{action:"login"}),this.__post(t)},REGISTER:function(t){t=$.extend(t,{action:"register"}),this.__post(t)},FINDPWD:function(t){t=$.extend(t,{action:"findpwd"}),this.__post(t)},CHECK:function(t,i,c){var o=this;$.get(n.url("user","&do=check"),t,function(t){o.__callback(t,i,c)},"json")}}});
iCMS.define("common",function(){var t=iCMS.require("api"),e=iCMS.require("utils"),a=iCMS.require("user"),i=iCMS.require("ui");return{__post:function(a,i,r,o){var n=this;$.post(t.url(i),a,function(t){e.callback(t,r,o,n,a)},"json")},vote:function(e,a,i){var r=iCMS.$v(e,"vote"),o=t.param(e);o=$.extend(o,{type:r[1],action:"vote"}),this.__post(o,r[0],a,i)},favorite:function(e,r){if(a.CHECK.LOGIN()){var o=($(e),$("#iCMS-FAVORITE-TPL")),n=o.html(),c=document.getElementById("iCMS-FAVORITE-DIALOG");c.innerHTML=c.innerHTML.replace("data-src","src");var l=i.dialog({title:o.data("title")||"添加到收藏夹",content:c,quickClose:!1,width:"auto",height:"auto"});$(".cancel",c).click(function(t){t.preventDefault(),l.remove()}),$(".create,.cancel_create",c).click(function(t){t.preventDefault(),$(this).hasClass("create")?l.title(o.data("create-title")||"创建新收藏夹"):l.title(o.data("title")||"添加到收藏夹"),$(".favorite_create",c).toggle(),$(".favorite_list",c).toggle()}),$('[name="create"]',c).click(function(e){e.preventDefault();var a={action:"create",title:$('[name="title"]',c).val(),description:$('[name="description"]',c).val(),mode:$('[name="mode"]:checked',c).val()};return""==a.title?($('[name="title"]',c).focus(),$(".favorite_create_error",c).text("请填写标题").show(),!1):void $.post(t.url("favorite"),a,function(t){if(t.code){var e=$.parseTmpl(n,{id:t.forward,title:a.title,count:0,follow:0,favorite:!1});$(".favorite_list_content",c).append(e),$('[name="title"]',c).val(""),$('[name="description"]',c).val(""),$(".favorite_create",c).toggle(),$(".favorite_list",c).toggle(),l.reset()}else $(".favorite_create_error",c).text(t.msg).show()},"json")}),$.post(t.url("favorite","&do=list"),t.param(e),function(t){var e="";$.each(t,function(t,a){e+=$.parseTmpl(n,a)}),$(".favorite_list_content",c).html(e),l.reset()},"json"),$(c).on("click",".favo-list-item-link",function(a){var r=$(this),o=t.param(e),n=parseInt($(".num",r).text());o.fid=r.attr("data-fid"),r.hasClass("active")?o.action="delete":o.action="add",$.post(t.url("favorite"),o,function(t){t.code?r.hasClass("active")?($(".num",r).text(n-1),r.removeClass("active")):($(".num",r).text(n+1),r.addClass("active")):i.alert(t.msg)},"json")})}}}});
iCMS.define("comment",function(){var e=iCMS.require("api"),n=iCMS.require("ui"),t=iCMS.require("user"),o=iCMS.require("utils"),i={seccode:iCMS.CONFIG.COMMENT.seccode,page_no:{},page_total:{},options:{more:'<a href="javascript:;" class="load-more" i="comment_load"><span class="text">显示全部评论</a>',spinner:$('<div class="commentApp-spinner">正在加载，请稍等...... <i class="spinner-lightgray"></i></div>'),up_label:"comment_up_label",up_num:"comment_up_num",list:"comment_list",form:"comment_form"},cache:{}};return $.extend(i,{setopt:function(e){return i.options=$.extend(i.options,e),this},template:function(n,t){return i.cache[n]?"function"==typeof t?t(i.cache[n]):i.cache[n]:void $.get(e.url("comment"),"&do=widget&name="+n,function(e){i.cache[n]=e,"function"==typeof t&&t(e)})},miniForm:function(e){i.template("mini.form",function(n){var t=$(n);t.on("focus",'[i="comment_content"]',function(e){e.preventDefault(),t.addClass("expanded")}).on("click",'[i="comment_cancel"]',function(e){e.preventDefault(),t.removeClass("expanded"),$('[i="comment_content"]',t).val("")}),e&&o.__callback(e,t)})},like:function(n,a,c){if(t.CHECK.LOGIN()){var m=this,p=$(n),r=i.options,s=e.param(p);m.SUCCESS=function(e,n){var t=p.parent(),o=iCMS.$(r.up_num,t).text();o=parseInt(o)+1,iCMS.$(r.up_label,t).show(),iCMS.$(r.up_num,t).text(o)},s["do"]="like",$.get(e.url("comment"),s,function(e){o.callback(e,a,c,m)},"json")}},reply:function(e){if(t.CHECK.LOGIN()){var n=$(e).parent().parent(),o=$(".commentApp-form",n);if(o.length>0)return o.remove(),!1;$(".commentApp-form",".commentApp-list").remove(),$(".commentApp-form").removeClass("expanded");var a=$(e).param();i.miniForm(function(t){t.on("click",'[i="comment_cancel"]',function(e){e.preventDefault(),iCMS.$("comment_content",t).data("param",a).focus().val(""),t.remove()}).on("click",'[i="comment_add"]',function(e){e.preventDefault(),i.options.list=n.parent(),i.add(a,t,null,"after")}).addClass("expanded"),$(e).parent().after(t)})}},add:function(e,t,o,a){i.options.form=t,i.post(e,function(n){"function"==typeof o&&o(n),i.template("item"),$(".commentApp-item.empty").remove(),i.getlist(e.iid,n.forward,a||"append")},function(e){n.alert(e.msg)})},post:function(a,c,m,p){if(t.CHECK.LOGIN()){var r=this,s=i.options;if(p=p||iCMS.$(s.form),"1"==i.seccode){var l=iCMS.$("comment_seccode",p);if(a.seccode=l.val(),!a.seccode)return l.focus(),!1}var u=iCMS.$("comment_content",p);if(a.content=u.val(),!a.content)return u.focus(),!1;var f=function(e){"seccode"!=e.forward&&u.val(""),"undefined"!=typeof l&&(l.val(""),n.seccode())},d=u.data("param");"undefined"!=typeof d&&(a=$.extend(a,d)),a.action="add",$.post(e.url("comment"),a,function(e){f(e),o.callback(e,c,m,r)},"json")}},page:function(e,n,t){var i=$(n),a=i.parent(),c=(a.parent(),a.attr("data-query")),m=iCMS.CONFIG.API+"?"+c+"&pn="+e;$.get(m,function(e){o.__callback(t,e)})},getlist:function(n,o,a,c){if(!o&&(i.page_no[n]++,i.page_total[n]&&i.page_no[n]>i.page_total[n]))return!1;var m=i.options;c=c||iCMS.$(m.list),$.get(e.url("comment"),{"do":"json",iid:n,id:o||0,by:"ASC",page:i.page_no[n]},function(e){return i.options.spinner.remove(),!!e&&(o||(i.page_total[n]=e[0].page.total),$.each(e,function(e,n){var o=$.parseTmpl(i.cache.item,n);t.UCARD(o),"after"==a?c.after(o):"before"==a?c.before(o):c.append(o)}),void(o||(iCMS.$("comment_load").remove(),i.page_no[n]<i.page_total[n]&&c.after(m.more))))},"json")},create:function(n){var t=$(n),o=t.parent(),a=o.parent(),c=e.param(o),m=$(".commentApp-wrap",a);if(m.length>0)return m.remove(),!1;$(".commentApp-wrap").remove();var p=$('<i class="ui-icon comment-spike-icon commentApp-bubble"></i>'),r=$('<div class="commentApp-wrap">'),s=$('<div class="commentApp-list">'),l=c.iid,u=t.position(),f="createTouch"in document&&!("onmousemove"in document)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent);p.css({left:f?event.offsetX:u.left,display:"inline"}),r.html(i.options.spinner),r.append(p,s),i.options.list=s,i.miniForm(function(e){e.addClass("commentApp-wrap-ft"),r.append(e),e.on("click",'[i="comment_add"]',function(n){n.preventDefault(),i.add(c,e,function(e){var n=parseInt(iCMS.$("comment_num",t).text());iCMS.$("comment_num",t).text(n+1)})})}),o.after(r),i.template("item",function(e){i.page_no[l]=0,i.page_total[l]=0,i.getlist(l)}),r.on("click",'[i="comment_load"]',function(e){e.preventDefault(),s.append(i.options.spinner),i.getlist(l)})}})});
iCMS.define("former",{select:function(e,i){var c=i.split(",");$("#"+e).val(c).trigger("chosen:updated")},checked:function(e,i){if(i){var c=i.split(",");$.each(c,function(i,c){$(e+'[value="'+c+'"]').prop("checked",!0)})}$.uniform&&$.uniform.update(e)}});
window.iCMS=$.extend(window.iCMS,{API:iCMS.require("api"),init:function(i){var r=iCMS.require("config");iCMS.CONFIG=$.extend(r,i),iCMS.UI=iCMS.require("ui"),iCMS.FORMER=iCMS.require("former"),iCMS.dialog=iCMS.UI.dialog,iCMS.alert=iCMS.UI.alert}}),function(i){i.fn.param=function(){return window.iCMS.API.param(this)}}(jQuery);

})(jQuery)